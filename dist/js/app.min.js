"use strict";!function(){angular.module("numbleApp",["ngRoute","angular-intro","angular-gestures"])}(),function(){angular.module("numbleApp").factory("boardService",function(){function e(){var t=Math.floor(10*Math.random());return-1!==o.indexOf(t)?e():t}function t(t,n){for(var r=[],a=0;4>=a;a++){r.push([]);for(var i=0;4>=i;i++){var c=(n||[]).shift(),l=c||e();0===l&&o.push(0),r[a][i]={x:a,y:i,display:l,select:t(a,i)}}}return r}function n(e,t){var n=Math.abs(e.x-t.x),r=Math.abs(e.y-t.y);return 1>=n&&1>=r}function r(e){return e?e.split(","):void 0}var o=[];return{getBoard:t,getNewCellValue:e,areTouching:n,parseLayout:r}})}(),function(){angular.module("numbleApp").controller("GameCtrl",["$scope","$routeParams","$location","stateService","storageService","boardService","timeService","selectionService",function(e,t,n,r,o,a,i,c){function l(e){var t=r.state;c.isValidMove(e,t.selected)&&(e.replace=!1,c.makeSelection(e))}function u(t,n){return function(){l(e.state.board[t][n])}}i.setAlert(function(){r.state.score>e.mustBeat.score?n.url("/new-high-score"):n.url("/results")}),o.getMonthlyHighScores().then(function(t){t.length<5?e.mustBeat={score:0}:e.mustBeat=t[t.length-1]}),e.state=r.state,e.scoreStorage=o.getScore(t.goal),e.scoreStorage.then(function(t){e.state.board=a.getBoard(u,a.parseLayout(t?t.values:null)),e.goal=t?t.score:null,i.startTimer(i.GAME_TIME)}),e.scoreStorage=o.getScore(t.goal),e.undo=r.undo}])}(),function(){Date.prototype.getWeek=function(){var e=new Date((void 0).getFullYear(),0,1);return Math.ceil(((void 0-e)/864e5+e.getDay()+1)/7)}}(),function(){angular.module("numbleApp").config(["hammerDefaultOptsProvider",function(e){var t={recognizers:[[Hammer.Tap,{time:250}]]};e.set(t)}])}(),function(){angular.module("numbleApp").controller("HighScoreCtrl",["$scope","storageService",function(e,t){e.mode="monthly",e.setMode=function(t){return e.mode=t},e.monthlyRequest=t.getMonthlyHighScores(),e.monthlyRequest.then(function(t){return e.monthlyScores=t}),e.lifetimeRequest=t.getLifetimeHighScores(),e.lifetimeRequest.then(function(t){return e.lifetimeScores=t})}])}(),function(){angular.module("numbleApp").directive("navButton",["$location",function(e){return{restrict:"E",replace:!0,templateUrl:"js/navButton.html",transclude:!0,scope:{navButtonUrl:"@"},link:function(t){t.follow=function(){e.url("/"+t.navButtonUrl)}}}}])}(),function(){angular.module("numbleApp").controller("NewHighScoreCtrl",["$scope","$location","stateService","storageService",function(e,t,n,r){e.score=n.state.score,e.submit=function(e){r.submitHighScore(e).then(function(){return t.url("/high-scores")})}}])}(),function(){angular.module("numbleApp").controller("ResultsCtrl",["$scope","stateService","storageService","$location",function(e,t,n,r){function o(){e.storage=n.storeScore(),e.storage.then(function(t){e.shareId=t.name})}function a(){t.resetGame(),r.url("/play")}function i(){t.resetGame(),r.url("/")}function c(){e.storage||o(),e.shareVisible=!0}e.score=t.state.score,e.startOver=a,e.changeGameMode=i,e.getShare=c,0!==t.state.score&&o()}])}(),function(){angular.module("numbleApp").config(["$routeProvider",function(e){e.when("/",{templateUrl:"partials/start.html",controller:"StartCtrl"}).when("/tutorial",{templateUrl:"partials/tutorial.html",controller:"TutorialCtrl"}).when("/new-high-score",{templateUrl:"partials/new-high-score.html",controller:"NewHighScoreCtrl"}).when("/high-scores",{templateUrl:"partials/high-scores.html",controller:"HighScoreCtrl"}).when("/play",{templateUrl:"partials/game.html",controller:"GameCtrl"}).when("/results",{templateUrl:"partials/results.html",controller:"ResultsCtrl"}).otherwise({redirectTo:"/"})}])}(),function(){angular.module("numbleApp").directive("numSelect",["$window",function(e){return{restrict:"A",link:function(t,n){var r=e.getSelection(),o=document.createRange();o.selectNodeContents(n[0]),r.removeAllRanges(),r.addRange(o)}}}])}(),function(){angular.module("numbleApp").factory("selectionService",["boardService","winService","stateService","timeService",function(e,t,n,r){function o(o){o.selected=!0,n.state.selected.push(o);var a=n.state.selected.map(function(e){return e.display}),i=t.check(a);i.forEach(function(o){if(-1===n.state.found.indexOf(o)){n.state.selected.forEach(function(t){t.replace=!0,"rotating"===n.state.mode&&(t.display=e.getNewCellValue())}),"rotating"!==n.state.mode&&n.state.found.push(o);var a=t.getScore(o);n.state.score+=a,r.addTime(a),n.undo()}})}function a(t,n){return t.selected?!1:!(n.length>0)||e.areTouching(t,n[n.length-1])}return{isValidMove:a,makeSelection:o}}])}(),function(){angular.module("numbleApp").controller("StartCtrl",["$scope","$location","stateService",function(e,t,n){function r(e){n.state.mode=e,t.url("/play")}function o(e){t.url("/"+e)}e.start=r,e.goTo=o}])}(),function(){angular.module("numbleApp").factory("stateService",function(){function e(){n.selected.forEach(function(e){e.selected=!1}),n.selected.length=0}function t(){e(),n.found.length=0,n.score=0}var n={board:[],selected:[],found:[],mode:"normal",score:0};return{undo:e,resetGame:t,state:n}})}(),function(){angular.module("numbleApp").factory("storageService",["$http","$q","stateService",function(e,t,n){function r(e){var t=n.state.board.reduce(function(e,t){return e+t.reduce(function(e,t){return e+t.display+","},"")},"");return{callsign:e,score:n.state.score,values:t.substring(0,t.length-1),date:new Date+"",mode:n.state.mode}}function o(){return e.post(h+".json",r()).then(function(e){return e.data})}function a(e){return e.data?Object.keys(e.data).map(function(t){return e.data[t]}).sort(function(e,t){return t.score-e.score}).slice(0,5):[]}function i(){return e.get(d+".json").then(a)}function c(){return e.get(m+".json").then(a)}function l(n){var o=e.post(m+".json",r(n)),a=e.post(d+".json",r(n));return t.all([o,a])}function u(n){return n?e.get(h+"/"+n+".json").then(function(e){return e.data}):t.resolve()}var s="https://project-8921628173750252600.firebaseio.com",h=s+"/games",d=s+"/high-scores/monthly/"+(new Date).getFullYear()+"-"+(new Date).getMonth(),m=s+"/high-scores/lifetime";return{getScore:u,getMonthlyHighScores:i,getLifetimeHighScores:c,submitHighScore:l,storeScore:o}}])}(),function(){angular.module("numbleApp").factory("timeService",["$timeout",function(e){function t(){if(c--,0===c)for(;l.length>0;)l.pop()();else e(t,1e3)}function n(n){c=n,e(t,1e3)}function r(){c=0,l.length=0}function o(){return c}function a(e){c+=e}function i(e){l.push(e)}var c,l=[];return{addTime:a,getTime:o,resetTimer:r,setAlert:i,startTimer:n,GAME_TIME:60}}])}(),function(){angular.module("numbleApp").directive("numTimer",["timeService",function(e){return{restrict:"E",templateUrl:"templates/timer.html",scope:{},link:function(t){var n=e.GAME_TIME;t.timePercentage=function(){return 100*(e.getTime()-1)/n}}}}])}(),function(){angular.module("numbleApp").controller("TutorialCtrl",["$scope","$location","stateService","storageService","boardService","timeService","tutorialService","selectionService",function(e,t,n,r,o,a,i,c){function l(e){var t=n.state;c.isValidMove(e,t.selected)&&(e.replace=!1,c.makeSelection(e))}function u(t,n){return function(){l(e.state.board[t][n])}}var s={steps:[{element:"header",intro:"Welcome to Numble! The goal is to select numbers that add or multiply together into a formula. This sounds complicated, but it's not. I promise!",position:"bottom"},{element:"#board",intro:"This is the board. You will select adjacent numbers here to create a formula."},{element:"#board div:nth-child(1) span:nth-child(3)",intro:"When you click on this number, you can then click any number next to it."},{element:"#board div:nth-child(1) span:nth-child(1)",intro:"That means this is an invalid selection."},{element:"#board div:nth-child(2) span:nth-child(2)",intro:"But that this is valid!"},{element:"#board div:nth-child(2) span:nth-child(3)",intro:"And since 2+3=5, we can select this one to get a point!"},{element:"header h1",intro:"There we go! You get 1 point for a 3 number string, but more the longer you can go."},{element:"header h1",intro:"Since 8 times 3 is 24, let's try to find that on the board."},{element:"#board div:nth-child(4) span:nth-child(3)",intro:"Here's an 8..."},{element:"#board div:nth-child(4) span:nth-child(4)",intro:"And our 3..."},{element:"#board div:nth-child(4) span:nth-child(5)",intro:"The start of our 24..."},{element:"#board div:nth-child(5) span:nth-child(4)",intro:"And that's the end of 24!"},{element:"header h1",intro:"See how we got more points for that one?"},{element:"#game header",intro:"Last thing. You don't have infinite time! Whenever you do get an answer, you get back a number of seconds equal to your score."},{element:"#game header",intro:"Time flies like an arrow, but fruit flies like a banana! Go have fun!"},{element:"#game header",intro:""}],showStepNumbers:!1,showBullets:!1,disableInteraction:!0,keyboardNavigation:!0,exitOnEsc:!1,exitOnOverlayClick:!1};e.state=n.state,e.scoreStorage=r.getScore(),e.state.board=o.getBoard(u,i.grid),e.undo=n.undo,e.tutorialOptions=s;var h=0;e.afterChange=function(){switch(h++){case 2:l(e.state.board[0][2]);break;case 4:l(e.state.board[1][1]);break;case 6:l(e.state.board[1][2]);break;case 8:l(e.state.board[3][2]);break;case 9:l(e.state.board[3][3]);break;case 10:l(e.state.board[3][4]);break;case 11:l(e.state.board[4][3]);break;case 13:a.startTimer(a.GAME_TIME);break;case 15:a.resetTimer(),t.url("/")}}}])}(),function(){angular.module("numbleApp").factory("tutorialService",function(){return{grid:[7,4,2,8,9,1,3,5,6,1,4,1,7,3,5,5,6,8,3,2,2,5,6,4,9]}})}(),function(){angular.module("numbleApp").factory("winService",function(){function e(e,t,n){return e+t===n}function t(e,t,n){return e*t===n}function n(n){for(var r=n.length,o=r-1,a=[],i=1;o>i;i++)for(var c=o-i;c>0;c--){var l=void 0,u=void 0,s=void 0;l=u=s=0;for(var h=i-1;h>=0;h--)l+=n[i-h-1]*Math.pow(10,h);for(var d=c-1;d>=0;d--)u+=n[c-d-1+i]*Math.pow(10,d);for(var m=c+i;r>m;m++)s+=n[m]*Math.pow(10,r-m-1);e(l,u,s)&&a.push(l+"+"+u+"="+s),t(l,u,s)&&a.push(l+"*"+u+"="+s)}return a}function r(e){switch(e.length-2){case 3:return 1;case 4:return 3;case 5:return 5;case 6:return 10;case 7:return 15;default:return 23}}return{check:n,getScore:r}})}();