"use strict";!function(){angular.module("numbleApp",["ngRoute","angular-gestures"])}(),function(){angular.module("numbleApp").factory("boardService",function(){function e(){var t=Math.floor(10*Math.random());return-1!==o.indexOf(t)?e():t}function t(t,n){for(var r=[],a=0;4>=a;a++){r.push([]);for(var u=0;4>=u;u++){var c=(n||[]).shift(),i=c||e();0===i&&o.push(0),r[a][u]={x:a,y:u,display:i,select:t(a,u)}}}return r}function n(e,t){var n=Math.abs(e.x-t.x),r=Math.abs(e.y-t.y);return 1>=n&&1>=r}function r(e){return e?e.split(","):void 0}var o=[];return{getBoard:t,getNewCellValue:e,areTouching:n,parseLayout:r}})}(),function(){angular.module("numbleApp").controller("GameCtrl",["$scope","$routeParams","stateService","storageService","boardService","timeService","selectionService",function(e,t,n,r,o,a,u){function c(t,n){return function(){i(e.state.board[t][n])}}function i(e){var t=n.state;u.isValidMove(e,t.selected)&&(e.replace=!1,u.makeSelection(e))}e.state=n.state,e.scoreStorage=r.getScore(t.goal),e.scoreStorage.then(function(t){e.state.board=o.getBoard(c,o.parseLayout(t?t.layout:null)),e.goal=t?t.score:null,a.startTimer(a.GAME_TIME)}),e.undo=n.undo}])}(),function(){angular.module("numbleApp").config(["hammerDefaultOptsProvider",function(e){var t={recognizers:[[Hammer.Tap,{time:250}]]};e.set(t)}])}(),function(){angular.module("numbleApp").controller("ResultsCtrl",["$scope","stateService","storageService","$location",function(e,t,n,r){function o(){t.resetGame(),r.url("/play")}function a(){t.resetGame(),r.url("/")}function u(){e.storage=n.storeScore(),e.storage.then(function(t){e.shareId=t.name})}e.score=t.state.score,e.startOver=o,e.changeGameMode=a,e.getShare=u}])}(),function(){angular.module("numbleApp").config(["$routeProvider",function(e){e.when("/",{templateUrl:"partials/start.html",controller:"StartCtrl"}).when("/play",{templateUrl:"partials/game.html",controller:"GameCtrl"}).when("/results",{templateUrl:"partials/results.html",controller:"ResultsCtrl"}).otherwise({redirectTo:"/"})}])}(),function(){angular.module("numbleApp").directive("numSelect",["$window",function(e){return{restrict:"A",link:function(t,n){var r=e.getSelection(),o=document.createRange();o.selectNodeContents(n[0]),r.removeAllRanges(),r.addRange(o)}}}])}(),function(){angular.module("numbleApp").factory("selectionService",["boardService","winService","stateService","timeService",function(e,t,n,r){function o(o){o.selected=!0,n.state.selected.push(o);var a=n.state.selected.map(function(e){return e.display}),u=t.check(a);u.forEach(function(o){if(-1===n.state.found.indexOf(o)){n.state.selected.forEach(function(t){t.replace=!0,"rotating"===n.state.mode&&(t.display=e.getNewCellValue())}),"rotating"!==n.state.mode&&n.state.found.push(o);var a=t.getScore(o);n.state.score+=a,r.addTime(a),n.undo()}})}function a(t,n){return t.selected?!1:!(n.length>0)||e.areTouching(t,n[n.length-1])}return{isValidMove:a,makeSelection:o}}])}(),function(){angular.module("numbleApp").controller("StartCtrl",["$scope","$location","stateService",function(e,t,n){function r(e){n.state.mode=e,t.url("/play")}e.start=r}])}(),function(){angular.module("numbleApp").factory("stateService",function(){function e(){n.selected.forEach(function(e){e.selected=!1}),n.selected.length=0}function t(){e(),n.found.length=0,n.score=0}var n={board:[],selected:[],found:[],mode:"normal",score:0};return{undo:e,resetGame:t,state:n}})}(),function(){angular.module("numbleApp").factory("storageService",["$http","$q","stateService",function(e,t,n){function r(){var t=n.state.board.reduce(function(e,t){return e+t.reduce(function(e,t){return e+t.display+","},"")},""),r={score:n.state.score,values:t.substring(0,t.length-1)};return e.post(a+".json",r).then(function(e){return e.data})}function o(n){return n?e.get(a+"/"+n+".json").then(function(e){return e.data}):t.resolve()}var a="https://project-8921628173750252600.firebaseio.com/games";return{getScore:o,storeScore:r}}])}(),function(){angular.module("numbleApp").factory("timeService",["$timeout",function(e){function t(){if(u--,0===u)for(;c.length>0;)c.pop()();else e(t,1e3)}function n(n){u=n,e(t,1e3)}function r(){return u}function o(e){u+=e}function a(e){c.push(e)}var u,c=[];return{addTime:o,getTime:r,setAlert:a,startTimer:n,GAME_TIME:60}}])}(),function(){angular.module("numbleApp").directive("numTimer",["timeService","$location",function(e,t){return{restrict:"E",templateUrl:"templates/timer.html",scope:{},link:function(n,r){var o=e.GAME_TIME;e.setAlert(function(){t.url("/results")}),n.timePercentage=function(){return 100*(e.getTime()-1)/o}}}}])}(),function(){angular.module("numbleApp").factory("winService",function(){function e(e,t,n){return e+t===n}function t(e,t,n){return e*t===n}function n(n){for(var r=n.length,o=r-1,a=[],u=1;o>u;u++)for(var c=o-u;c>0;c--){var i,l,s;i=l=s=0;for(var f=u-1;f>=0;f--)i+=n[u-f-1]*Math.pow(10,f);for(var m=c-1;m>=0;m--)l+=n[c-m-1+u]*Math.pow(10,m);for(var d=c+u;r>d;d++)s+=n[d]*Math.pow(10,r-d-1);e(i,l,s)&&a.push(i+"+"+l+"="+s),t(i,l,s)&&a.push(i+"*"+l+"="+s)}return a}function r(e){switch(e.length-2){case 3:return 1;case 4:return 3;case 5:return 5;case 6:return 10;case 7:return 15;default:return 23}}return{check:n,getScore:r}})}();